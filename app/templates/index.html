<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroScan AI — Brain Tumor Segmentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary:    #ffffff;
            --bg-secondary:  #fafafa;
            --bg-tertiary:   #f5f5f5;
            --border-light:  #e5e5e5;
            --border-medium: #d4d4d4;
            --border-dark:   #a3a3a3;
            --text-primary:  #0a0a0a;
            --text-secondary:#525252;
            --text-tertiary: #737373;
            --accent-primary:#000000;
            --accent-secondary:#262626;
            --success:       #16a34a;
            --danger:        #dc2626;
            --warning:       #ea580c;
            --info:          #0284c7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'IBM Plex Sans', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        /* ── Layout ── */
        .page-container {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        /* ── Sidebar ── */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            padding: 2rem 0;
            display: flex;
            flex-direction: column;
        }

        .logo-section {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid var(--border-light);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .logo-icon {
            width: 32px; height: 32px;
            background: var(--accent-primary);
            display: flex; align-items: center; justify-content: center;
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600; font-size: 16px; color: white;
        }

        .logo-text    { font-size: 1.125rem; font-weight: 600; letter-spacing: -0.01em; }
        .logo-subtitle {
            font-size: 0.75rem; color: var(--text-tertiary);
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: 0.05em; text-transform: uppercase;
        }

        .nav-section  { padding: 1.5rem 1rem; }
        .nav-label {
            font-size: 0.6875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--text-tertiary); padding: 0 0.5rem; margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.625rem 0.75rem;
            color: var(--text-secondary); text-decoration: none;
            font-size: 0.875rem; border-radius: 4px;
            transition: all 0.15s ease; font-weight: 500;
        }
        .nav-item:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .nav-item.active { background: var(--accent-primary); color: white; }
        .nav-icon { width: 16px; height: 16px; }

        .sidebar-footer {
            margin-top: auto; padding: 1.5rem;
            border-top: 1px solid var(--border-light);
        }

        .status-indicator {
            display: flex; align-items: center; gap: 0.5rem;
            font-size: 0.75rem; color: var(--text-tertiary);
            font-family: 'IBM Plex Mono', monospace;
        }
        .status-dot {
            width: 6px; height: 6px; border-radius: 50%; background: var(--success);
        }

        /* ── Main ── */
        .main-content { display: flex; flex-direction: column; }

        .top-bar {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
        }

        .breadcrumb {
            display: flex; align-items: center; gap: 0.5rem;
            font-size: 0.875rem; color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
        }
        .breadcrumb-separator { color: var(--border-dark); }

        .top-actions { display: flex; gap: 0.75rem; }
        .info-chip {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: var(--bg-secondary); border: 1px solid var(--border-light);
            border-radius: 4px; font-size: 0.75rem;
            font-family: 'IBM Plex Mono', monospace; color: var(--text-secondary);
        }

        .content-area { flex: 1; padding: 2rem; background: var(--bg-secondary); }
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 1.5rem;
            max-width: 1400px;
        }

        /* ── Cards ── */
        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 0;
        }
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-light);
        }
        .card-title {
            font-size: 0.875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.05em;
            color: var(--text-primary);
        }
        .card-subtitle {
            font-size: 0.75rem; color: var(--text-tertiary);
            margin-top: 0.25rem; font-family: 'IBM Plex Mono', monospace;
        }
        .card-body { padding: 1.5rem; }

        /* ── Upload ── */
        .upload-container {
            border: 2px dashed var(--border-medium);
            background: var(--bg-secondary);
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .upload-container:hover,
        .upload-container.drag-over {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
            border-style: solid;
        }

        .upload-icon { width: 48px; height: 48px; margin: 0 auto 1.25rem; stroke: var(--text-tertiary); }
        .upload-title { font-size: 0.9375rem; font-weight: 600; margin-bottom: 0.5rem; }
        .upload-description {
            font-size: 0.8125rem; color: var(--text-tertiary);
            margin-bottom: 1.5rem; font-family: 'IBM Plex Mono', monospace;
        }
        .upload-formats { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 1.5rem; }

        /* ── Buttons ── */
        .btn {
            display: inline-block; padding: 0.625rem 1.5rem;
            font-size: 0.875rem; font-weight: 600;
            border: 2px solid var(--accent-primary);
            background: var(--accent-primary); color: white;
            cursor: pointer; transition: all 0.15s ease;
            text-transform: uppercase; letter-spacing: 0.05em;
            font-family: 'IBM Plex Sans', sans-serif;
        }
        .btn:hover { background: var(--accent-secondary); border-color: var(--accent-secondary); }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; color: var(--accent-primary); }
        .btn-outline:hover { background: var(--accent-primary); color: white; }
        input[type="file"] { display: none; }

        /* ── Preview ── */
        .preview-grid {
            display: none;
            grid-template-columns: 180px 1fr;
            gap: 1.5rem; padding: 1.5rem;
            border: 1px solid var(--border-light);
            background: var(--bg-secondary);
            margin-top: 1.5rem;
        }
        .preview-grid.show { display: grid; }

        .preview-image {
            width: 180px; height: 180px;
            object-fit: cover;
            border: 1px solid var(--border-light); background: #000;
        }

        .preview-metadata { display: flex; flex-direction: column; gap: 0.75rem; }
        .metadata-row {
            display: flex; justify-content: space-between;
            padding-bottom: 0.75rem; border-bottom: 1px solid var(--border-light);
        }
        .metadata-row:last-child { border-bottom: none; }
        .metadata-label {
            font-size: 0.75rem; text-transform: uppercase;
            letter-spacing: 0.05em; color: var(--text-tertiary); font-weight: 600;
        }
        .metadata-value { font-size: 0.8125rem; font-family: 'IBM Plex Mono', monospace; }

        .action-buttons { display: flex; gap: 0.75rem; margin-top: 1.5rem; }
        .action-buttons .btn { flex: 1; }

        /* ── Loading ── */
        .loading-overlay {
            display: none; align-items: center; justify-content: center;
            flex-direction: column; gap: 1rem;
            padding: 3rem; margin-top: 1.5rem;
            border: 1px solid var(--border-light); background: var(--bg-secondary);
        }
        .loading-overlay.show { display: flex; }

        .loading-spinner {
            width: 36px; height: 36px;
            border: 2px solid var(--border-light);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text {
            font-size: 0.875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.05em;
        }
        .loading-progress {
            font-size: 0.75rem; color: var(--text-tertiary);
            font-family: 'IBM Plex Mono', monospace;
        }

        /* ── Results ── */
        .results-container {
            display: none; margin-top: 1.5rem;
            border: 1px solid var(--border-light);
        }
        .results-container.show { display: block; }

        .result-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex; justify-content: space-between; align-items: center;
            background: var(--bg-secondary);
        }
        .result-title {
            font-size: 0.75rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.08em;
        }
        .result-timestamp {
            font-size: 0.75rem; font-family: 'IBM Plex Mono', monospace;
            color: var(--text-tertiary);
        }

        .result-body { padding: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem; }

        /* ── Verdict banner ── */
        .verdict-banner {
            padding: 1.25rem 1.5rem;
            display: flex; align-items: center; gap: 1rem;
            border-left: 4px solid var(--border-medium);
        }
        .verdict-banner.detected {
            background: #fff5f5;
            border-left-color: var(--danger);
        }
        .verdict-banner.clear {
            background: #f0fdf4;
            border-left-color: var(--success);
        }
        .verdict-dot {
            width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0;
        }
        .verdict-dot.detected { background: var(--danger); }
        .verdict-dot.clear    { background: var(--success); }

        .verdict-text-block { display: flex; flex-direction: column; gap: 0.2rem; }
        .verdict-label {
            font-size: 0.6875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-tertiary);
        }
        .verdict-value {
            font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em;
        }
        .verdict-value.detected { color: var(--danger); }
        .verdict-value.clear    { color: var(--success); }

        .verdict-coverage {
            margin-left: auto;
            text-align: right;
        }
        .coverage-label {
            font-size: 0.6875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-tertiary);
        }
        .coverage-value {
            font-size: 1.5rem; font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* ── Output image panels ── */
        .output-images {
            display: flex; flex-direction: column; gap: 0.75rem;
        }
        .output-img-label {
            font-size: 0.6875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--text-tertiary); margin-bottom: 0.5rem;
        }
        .output-img {
            width: 100%; border: 1px solid var(--border-light);
            display: block; background: #0a0a0a;
        }

        /* ── Pixel stats bar ── */
        .pixel-bar-wrap { display: flex; flex-direction: column; gap: 0.5rem; }
        .pixel-bar-header {
            display: flex; justify-content: space-between;
        }
        .pixel-bar-label {
            font-size: 0.6875rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-tertiary);
        }
        .pixel-bar-value {
            font-size: 0.75rem; font-family: 'IBM Plex Mono', monospace;
        }
        .pixel-track {
            height: 6px; background: var(--border-light); position: relative; overflow: hidden;
        }
        .pixel-fill {
            height: 100%; background: var(--danger);
            width: 0%; transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .pixel-fill.clear { background: var(--success); }

        /* ── Info panel ── */
        .info-panel { display: flex; flex-direction: column; gap: 1.5rem; }
        .info-card { background: var(--bg-primary); border: 1px solid var(--border-light); }

        .stat-grid {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 1rem; padding: 1.5rem;
        }
        .stat-item {
            padding: 1rem; background: var(--bg-secondary);
            border: 1px solid var(--border-light);
        }
        .stat-label {
            font-size: 0.6875rem; text-transform: uppercase;
            letter-spacing: 0.1em; color: var(--text-tertiary);
            margin-bottom: 0.5rem; font-weight: 600;
        }
        .stat-value {
            font-size: 1.5rem; font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: -0.02em;
        }
        .stat-unit { font-size: 0.875rem; font-weight: 400; color: var(--text-tertiary); }

        .system-info { padding: 1.25rem 1.5rem; display: flex; flex-direction: column; gap: 0.875rem; }
        .system-row {
            display: flex; justify-content: space-between; align-items: baseline;
            padding-bottom: 0.875rem; border-bottom: 1px solid var(--border-light);
            font-size: 0.8125rem;
        }
        .system-row:last-child { border-bottom: none; padding-bottom: 0; }
        .system-label { color: var(--text-tertiary); }
        .system-value { font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; }

        /* ── Legend ── */
        .legend-block { padding: 1.25rem 1.5rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .legend-row { display: flex; align-items: center; gap: 0.75rem; font-size: 0.8125rem; }
        .legend-swatch { width: 14px; height: 14px; border-radius: 2px; flex-shrink: 0; }

        /* ── Responsive ── */
        @media (max-width: 1100px) {
            .page-container { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .content-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .top-bar { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .content-area { padding: 1rem; }
            .preview-grid { grid-template-columns: 1fr; }
            .preview-image { width: 100%; height: auto; }
            .stat-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="page-container">

    <!-- ── Sidebar ── -->
    <aside class="sidebar">
        <div class="logo-section">
            <div class="logo">
                <div class="logo-icon">N</div>
                <div>
                    <div class="logo-text">NeuroScan</div>
                    <div class="logo-subtitle">AI System</div>
                </div>
            </div>
        </div>

        <nav class="nav-section">
            <div class="nav-label">Analysis</div>
            <a href="#" class="nav-item active">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                    <path d="M8 11h6M11 8v6"/>
                </svg>
                New Segmentation
            </a>
            <a href="#" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                </svg>
                History
            </a>
            <a href="#" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                </svg>
                Statistics
            </a>
        </nav>

        <nav class="nav-section">
            <div class="nav-label">Settings</div>
            <a href="#" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
                </svg>
                Preferences
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span>System Online</span>
            </div>
        </div>
    </aside>

    <!-- ── Main ── -->
    <main class="main-content">
        <div class="top-bar">
            <div class="breadcrumb">
                <span>Analysis</span>
                <span class="breadcrumb-separator">/</span>
                <span>Tumor Segmentation</span>
            </div>
            <div class="top-actions">
                <div class="info-chip">Model: U-Net + VGG16</div>
                <div class="info-chip" id="chipIoU">IoU: 71.1%</div>
                <div class="info-chip" id="chipDice">Dice: 78.2%</div>
            </div>
        </div>

        <div class="content-area">
            <div class="content-grid">

                <!-- ── Left column ── -->
                <div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">MRI Scan Upload</div>
                            <div class="card-subtitle">Upload a brain MRI scan — model will predict pixel-level tumor location</div>
                        </div>
                        <div class="card-body">

                            <!-- Drop zone -->
                            <div class="upload-container" id="uploadArea">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                <div class="upload-title">Drop MRI scan here</div>
                                <div class="upload-description">or click to browse files</div>
                                <div class="upload-formats">Supported: JPEG · PNG · TIFF · Max 10 MB</div>
                                <button class="btn" onclick="document.getElementById('fileInput').click()">Select File</button>
                                <input type="file" id="fileInput" accept="image/*,.tif,.tiff">
                            </div>

                            <!-- File preview -->
                            <div class="preview-grid" id="previewSection">
                                <div>
                                    <img id="previewImage" class="preview-image" alt="MRI Preview">
                                </div>
                                <div class="preview-metadata">
                                    <div class="metadata-row">
                                        <span class="metadata-label">Filename</span>
                                        <span class="metadata-value" id="fileName">—</span>
                                    </div>
                                    <div class="metadata-row">
                                        <span class="metadata-label">File Size</span>
                                        <span class="metadata-value" id="fileSize">—</span>
                                    </div>
                                    <div class="metadata-row">
                                        <span class="metadata-label">Format</span>
                                        <span class="metadata-value" id="fileFormat">—</span>
                                    </div>
                                    <div class="metadata-row">
                                        <span class="metadata-label">Dimensions</span>
                                        <span class="metadata-value" id="fileDimensions">—</span>
                                    </div>
                                    <div class="action-buttons">
                                        <button class="btn btn-outline" onclick="removeImage()">Remove</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Analyze button -->
                            <div class="action-buttons" id="analyzeSection" style="display:none; margin-top:1.5rem;">
                                <button class="btn" id="analyzeButton" onclick="analyzeImage()">
                                    Run Segmentation
                                </button>
                            </div>

                            <!-- Loading -->
                            <div class="loading-overlay" id="loadingSection">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">Processing Scan</div>
                                <div class="loading-progress">Running U-Net segmentation inference...</div>
                            </div>

                            <!-- Results -->
                            <div class="results-container" id="resultsSection">
                                <div class="result-header">
                                    <div class="result-title">Segmentation Results</div>
                                    <div class="result-timestamp" id="timestamp">--:--:--</div>
                                </div>
                                <div class="result-body">

                                    <!-- Verdict -->
                                    <div class="verdict-banner" id="verdictBanner">
                                        <div class="verdict-dot" id="verdictDot"></div>
                                        <div class="verdict-text-block">
                                            <div class="verdict-label">Diagnosis</div>
                                            <div class="verdict-value" id="verdictValue">—</div>
                                        </div>
                                        <div class="verdict-coverage">
                                            <div class="coverage-label">Tumor Coverage</div>
                                            <div class="coverage-value" id="coverageValue">—</div>
                                        </div>
                                    </div>

                                    <!-- Pixel bar -->
                                    <div class="pixel-bar-wrap">
                                        <div class="pixel-bar-header">
                                            <span class="pixel-bar-label">Tumor Pixels</span>
                                            <span class="pixel-bar-value" id="pixelCount">—</span>
                                        </div>
                                        <div class="pixel-track">
                                            <div class="pixel-fill" id="pixelBar"></div>
                                        </div>
                                    </div>

                                    <!-- Output images -->
                                    <div class="output-images">
                                        <div class="output-img-label">Segmentation Output — MRI · Mask · Overlay</div>
                                        <img id="overlayImage" class="output-img" alt="Segmentation overlay" style="display:none;">
                                    </div>

                                    <div class="output-images">
                                        <div class="output-img-label">Model Confidence Heatmap</div>
                                        <img id="heatmapImage" class="output-img" alt="Confidence heatmap" style="display:none; max-height: 260px; object-fit: contain; background:#0a0a0a;">
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- ── Right column ── -->
                <div class="info-panel">

                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">Model Performance</div>
                        </div>
                        <div class="stat-grid">
                            <div class="stat-item">
                                <div class="stat-label">Val IoU</div>
                                <div class="stat-value" id="statIoU">71.1<span class="stat-unit">%</span></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Val Dice</div>
                                <div class="stat-value" id="statDice">78.2<span class="stat-unit">%</span></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Test IoU</div>
                                <div class="stat-value">73.9<span class="stat-unit">%</span></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Test Dice</div>
                                <div class="stat-value">81.2<span class="stat-unit">%</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">System Information</div>
                        </div>
                        <div class="system-info">
                            <div class="system-row">
                                <span class="system-label">Model Version</span>
                                <span class="system-value">v2.0</span>
                            </div>
                            <div class="system-row">
                                <span class="system-label">Architecture</span>
                                <span class="system-value">U-Net + VGG16</span>
                            </div>
                            <div class="system-row">
                                <span class="system-label">Task</span>
                                <span class="system-value">Binary Segmentation</span>
                            </div>
                            <div class="system-row">
                                <span class="system-label">Dataset</span>
                                <span class="system-value">LGG kaggle_3m</span>
                            </div>
                            <div class="system-row">
                                <span class="system-label">Parameters</span>
                                <span class="system-value">23.7M</span>
                            </div>
                            <div class="system-row">
                                <span class="system-label">Epochs Trained</span>
                                <span class="system-value" id="statEpoch">20</span>
                            </div>
                            <div class="system-row">
                                <span class="system-label">Status</span>
                                <span class="system-value">Active</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="card-header">
                            <div class="card-title">Output Legend</div>
                        </div>
                        <div class="legend-block">
                            <div class="legend-row">
                                <div class="legend-swatch" style="background:#1a1a1a; border:1px solid #d4d4d4;"></div>
                                <span>Original MRI scan (grayscale)</span>
                            </div>
                            <div class="legend-row">
                                <div class="legend-swatch" style="background:#dc2626;"></div>
                                <span>Predicted tumor region</span>
                            </div>
                            <div class="legend-row">
                                <div class="legend-swatch" style="background: linear-gradient(to right, #000, #ff4400, #ffff00);"></div>
                                <span>Confidence heatmap (black → red → yellow)</span>
                            </div>
                            <div class="legend-row" style="margin-top: 0.5rem; padding-top: 0.75rem; border-top: 1px solid var(--border-light);">
                                <span style="font-size: 0.75rem; color: var(--text-tertiary); font-family: 'IBM Plex Mono', monospace;">
                                    ⚠ For research use only. Not a clinical diagnostic tool.
                                </span>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </main>
</div>

<script>
    const uploadArea     = document.getElementById('uploadArea');
    const fileInput      = document.getElementById('fileInput');
    const previewSection = document.getElementById('previewSection');
    const previewImage   = document.getElementById('previewImage');
    const analyzeSection = document.getElementById('analyzeSection');
    const loadingSection = document.getElementById('loadingSection');
    const resultsSection = document.getElementById('resultsSection');
    let selectedFile = null;

    // ── Drag and drop ──────────────────────────────────────────
    uploadArea.addEventListener('dragover', e => {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
    });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('drag-over'));
    uploadArea.addEventListener('drop', e => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
        if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', e => {
        if (e.target.files.length > 0) handleFile(e.target.files[0]);
    });

    // ── Handle file selection ──────────────────────────────────
    function handleFile(file) {
        selectedFile = file;

        const ext = file.name.split('.').pop().toUpperCase();

        // For TIFF files the browser can't display them natively — show placeholder
        if (['TIF', 'TIFF'].includes(ext)) {
            previewImage.src = '';
            previewImage.alt = 'TIFF — preview not available in browser';
            previewImage.style.background = '#0a0a0a';
        } else {
            const reader = new FileReader();
            reader.onload = e => {
                previewImage.src = e.target.result;
                const img = new Image();
                img.onload = () => {
                    document.getElementById('fileDimensions').textContent = `${img.width} × ${img.height}`;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        document.getElementById('fileName').textContent  = file.name;
        document.getElementById('fileSize').textContent  = (file.size / 1024).toFixed(1) + ' KB';
        document.getElementById('fileFormat').textContent = ext;

        previewSection.classList.add('show');
        analyzeSection.style.display = 'block';
        resultsSection.classList.remove('show');
    }

    // ── Remove image ───────────────────────────────────────────
    function removeImage() {
        selectedFile = null;
        fileInput.value = '';
        previewSection.classList.remove('show');
        analyzeSection.style.display = 'none';
        resultsSection.classList.remove('show');
    }

    // ── Run segmentation ───────────────────────────────────────
    function analyzeImage() {
        if (!selectedFile) return;

        analyzeSection.style.display = 'none';
        resultsSection.classList.remove('show');
        loadingSection.classList.add('show');

        const formData = new FormData();
        formData.append('file', selectedFile);

        fetch('/', { method: 'POST', body: formData })
        .then(r => r.json())
        .then(data => {
            loadingSection.classList.remove('show');

            if (data.error) {
                alert('Error: ' + data.error);
                analyzeSection.style.display = 'block';
                return;
            }

            // ── Timestamp ──
            const now = new Date();
            document.getElementById('timestamp').textContent =
                now.toLocaleTimeString('en-US', { hour12: false });

            // ── Verdict banner ──
            const banner    = document.getElementById('verdictBanner');
            const dot       = document.getElementById('verdictDot');
            const verdict   = document.getElementById('verdictValue');
            const coverage  = document.getElementById('coverageValue');

            if (data.tumor_detected) {
                banner.className  = 'verdict-banner detected';
                dot.className     = 'verdict-dot detected';
                verdict.className = 'verdict-value detected';
                verdict.textContent  = 'Tumor Detected';
            } else {
                banner.className  = 'verdict-banner clear';
                dot.className     = 'verdict-dot clear';
                verdict.className = 'verdict-value clear';
                verdict.textContent  = 'No Tumor Detected';
            }
            coverage.textContent = data.tumor_coverage.toFixed(2) + '%';

            // ── Pixel bar ──
            document.getElementById('pixelCount').textContent =
                `${data.tumor_pixels.toLocaleString()} / ${data.total_pixels.toLocaleString()} px`;
            const bar = document.getElementById('pixelBar');
            bar.className = 'pixel-fill' + (data.tumor_detected ? '' : ' clear');
            setTimeout(() => {
                bar.style.width = Math.min(data.tumor_coverage * 8, 100) + '%';
            }, 100);

            // ── Overlay image ──
            const overlayImg = document.getElementById('overlayImage');
            overlayImg.src = 'data:image/png;base64,' + data.overlay_image;
            overlayImg.style.display = 'block';

            // ── Heatmap image ──
            const heatmapImg = document.getElementById('heatmapImage');
            heatmapImg.src = 'data:image/png;base64,' + data.heatmap_image;
            heatmapImg.style.display = 'block';

            // ── Update stats from model checkpoint ──
            if (data.val_iou) {
                document.getElementById('statIoU').innerHTML    = data.val_iou + '<span class="stat-unit">%</span>';
                document.getElementById('statDice').innerHTML   = data.val_dice + '<span class="stat-unit">%</span>';
                document.getElementById('statEpoch').textContent = data.best_epoch;
                document.getElementById('chipIoU').textContent  = 'IoU: ' + data.val_iou + '%';
                document.getElementById('chipDice').textContent = 'Dice: ' + data.val_dice + '%';
            }

            resultsSection.classList.add('show');
            analyzeSection.style.display = 'block';
            document.getElementById('analyzeButton').textContent = 'Run New Segmentation';
        })
        .catch(err => {
            console.error(err);
            loadingSection.classList.remove('show');
            analyzeSection.style.display = 'block';
            alert('Segmentation failed. Please try again.');
        });
    }
</script>
</body>
</html>